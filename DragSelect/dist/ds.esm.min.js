const t=(t,e)=>{const s=e;window.addEventListener("resize",s),window.addEventListener("scroll",s);const i=new MutationObserver(s),r=new ResizeObserver(s);t.forEach(((t,e)=>{i.observe(t,{childList:0!==e,attributes:!0}),t instanceof Element&&r.observe(t)}));return{observer:i,resizeObserver:r,callback:s,cleanup:()=>{window.removeEventListener("resize",s),window.removeEventListener("scroll",s),i.disconnect(),r.disconnect()}}},e=(t,e)=>{let s;return(...i)=>{clearTimeout(s),s=setTimeout((()=>{s=void 0,t(...i)}),e)}},s=t=>{const e=(t,s=0)=>{const i=t[s]?.parentNode;return i?(t.push(i),s++,e(t,s)):t};return e([t])},i=({computedStyle:t,node:e})=>{const{position:s}=t;e instanceof Document||("absolute"===s||"relative"===s||"fixed"===s)||(e.style.position="relative")};let r;class n{DS;PS;Settings;_observers;_node;_parentNodes;_computedStyle;_computedBorder;_rect;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this._node=this.Settings.area,this.setArea(this.Settings.area),this.PS.subscribe("Settings:updated:area",(({settings:{area:t}})=>this.setArea(t))),this.PS.subscribe("Interaction:init",this.init),this.PS.subscribe("Interaction:end",this.reset)}setArea=t=>{this.reset(),this._node=t,i({computedStyle:this.computedStyle,node:this._node}),setTimeout((()=>{this.PS.publish("Area:modified:pre",{item:this.HTMLNode}),this.reset(),this.PS.publish("Area:modified",{item:this.HTMLNode})}))};init=()=>{this._observers=t(this.parentNodes,e((t=>{this.hasRelevantBeenModified()&&(this.PS.publish("Area:modified:pre",{event:t,item:this.HTMLNode}),this.reset(),this.PS.publish("Area:modified",{event:t,item:this.HTMLNode}))}),60))};hasRelevantBeenModified=()=>{const t=this.computedStyle,e=this.rect,s=this.computedBorder,i=this.parentNodes;return this.reset(),JSON.stringify(t)!==JSON.stringify(this.computedStyle)||(JSON.stringify(e)!==JSON.stringify(this.rect)||(JSON.stringify(s)!==JSON.stringify(this.computedBorder)||!(i.length===this.parentNodes.length||!i.some((t=>!this.parentNodes.includes(t))))))};reset=()=>{this._computedStyle=void 0,this._rect=void 0,this._computedBorder=void 0,this._parentNodes=void 0};stop=()=>{this._observers?.cleanup(),this.reset()};scroll=(t,e)=>{const s={scroll_directions:t,scroll_multiplier:e};this.PS.publish("Area:scroll:pre",s),((t,e,s=1)=>{if(!e?.length||!t)return;let i=t;if(t instanceof Document&&(r&&(i=r),Number.isFinite(document?.documentElement?.scrollTop))){const t=document.documentElement.scrollTop;document.documentElement.scrollTop+=1,document.documentElement.scrollTop===t?(i=document.body,r=document.body):(document.documentElement.scrollTop=t,i=document.documentElement,r=document.documentElement)}const n=e.includes("top")&&i.scrollTop>0,o=e.includes("bottom")&&i.scrollTop<i.scrollHeight,l=e.includes("left")&&i.scrollLeft>0,a=e.includes("right")&&i.scrollLeft<i.scrollWidth;n&&(i.scrollTop-=1*s),o&&(i.scrollTop+=1*s),l&&(i.scrollLeft-=1*s),a&&(i.scrollLeft+=1*s)})(this._node,t,e),this.PS.publish("Area:scroll",s)};get HTMLNode(){return this._node}get computedBorder(){return this._computedBorder?this._computedBorder:{top:parseInt(this.computedStyle.borderTopWidth),bottom:parseInt(this.computedStyle.borderBottomWidth),left:parseInt(this.computedStyle.borderLeftWidth),right:parseInt(this.computedStyle.borderRightWidth)}}get computedPadding(){return this._computedBorder?this._computedBorder:{top:parseInt(this.computedStyle.paddingTop),bottom:parseInt(this.computedStyle.paddingBottom),left:parseInt(this.computedStyle.paddingLeft),right:parseInt(this.computedStyle.paddingRight)}}get computedStyle(){if(this._computedStyle)return this._computedStyle;let t;t=this.HTMLNode instanceof Document?window.getComputedStyle(this.HTMLNode.body||this.HTMLNode.documentElement):window.getComputedStyle(this.HTMLNode);const e=this.HTMLNode instanceof Document?null:this.HTMLNode.parentElement;return this._computedStyle={borderTopWidth:t.borderTopWidth,borderBottomWidth:t.borderBottomWidth,borderLeftWidth:t.borderLeftWidth,borderRightWidth:t.borderRightWidth,position:t.position,paddingTop:t.paddingTop,paddingRight:t.paddingRight,paddingBottom:t.paddingBottom,paddingLeft:t.paddingLeft,height:e?""+(e.clientHeight-120):t.height}}get rect(){return this._rect=((t,e)=>{if(t instanceof Document)return{top:0,left:0,bottom:0,right:0,width:window.innerWidth,height:window.innerHeight};const s=t.getBoundingClientRect(),i=t.parentElement,r=i?i.clientHeight-135:null;return{top:s.top,left:s.left,bottom:s.bottom,right:s.right,width:(t.clientWidth||s.width)*e,height:(r||t.clientHeight||s.height)*e}})(this.HTMLNode,this.DS.stores.SettingsStore.s.zoom)}get parentNodes(){return this._parentNodes?this._parentNodes:this._parentNodes=s(this.HTMLNode)}}const o=({x:t,y:e},s,{x:i,y:r})=>({"+":{x:t+i,y:e+r},"-":{x:t-i,y:e-r},"*":{x:t*i,y:e*r},"/":{x:t/i,y:e/r}}[s]),l=t=>({x:t.left,y:t.top}),a=(t,e=0)=>({left:t.x,top:t.y,right:t.x,bottom:t.y,width:e,height:e}),h=t=>({x:t,y:t}),c=t=>{const e={x:0,y:0},s=window.getComputedStyle(t);if(!s.transform||"none"===s.transform)return e;if(s.transform.indexOf("3d")>=0){const t=s.transform.trim().match(/matrix3d\((.*?)\)/);if(t&&t.length){const s=t[1]?.split(",");e.x=parseInt(s[12])||0,e.y=parseInt(s[13])||0}return e}const i=s.transform.trim().match(/matrix\((.*?)\)/);if(i&&i.length){const t=i[1]?.split(",");e.x=parseInt(t[4])||0,e.y=parseInt(t[5])||0}return e},d=(t,e)=>e?(t=>{const{transform:e}=t.style;if(!e||e.indexOf("translate")<0)return c(t);const s={x:0,y:0},i=e.trim().match(/translate[3dD]*?\(.*?\)/);if(i){const t=i[0]?.split("(");if(t){const e=t[1]?.split(",");s.x=parseInt(e[0])||0,s.y=parseInt(e[1])||0}}return s.x||s.x?s:c(t)})(t):(t=>{const{style:e}=t,s={x:parseInt(e.left)||0,y:parseInt(e.top)||0};if(!s.x&&!s.x){const e=window.getComputedStyle(t);return{x:parseInt(e.left)||0,y:parseInt(e.top)||0}}return s})(t),S=({containerRect:t,selectionRect:e,direction:s,scrollAmount:i})=>s;class u{_prevCursorPos;_prevScrollPos;_elements=[];_dragKeys;_dragKeysFlat=[];_selectionRect=a(h(0));_draggingElement=null;_divElementOne=null;_divElementTwo=null;_readyDropZone=void 0;_styles;startDrag;DS;PS;Settings;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.startDrag=!1,this.PS.subscribe("Settings:updated:dragKeys",this.assignDragKeys),this.assignDragKeys(),this.PS.subscribe("Interaction:start",this.start),this.PS.subscribe("Interaction:end",this.stop),this.PS.subscribe("Interaction:update",this.update),this.PS.subscribe("KeyStore:down",this.keyboardDrag),this.PS.subscribe("KeyStore:up",this.keyboardEnd)}assignDragKeys=()=>{this._dragKeys={up:this.Settings.dragKeys.up.map((t=>t.toLowerCase())),down:this.Settings.dragKeys.down.map((t=>t.toLowerCase())),left:this.Settings.dragKeys.left.map((t=>t.toLowerCase())),right:this.Settings.dragKeys.right.map((t=>t.toLowerCase()))},this._dragKeysFlat=[...this._dragKeys.up,...this._dragKeys.down,...this._dragKeys.left,...this._dragKeys.right]};keyboardDrag=({event:t,key:e})=>{const s=e.toLowerCase();if(!this.Settings.keyboardDrag||!this._dragKeysFlat.includes(s)||!this.DS.SelectedSet.size||!this.Settings.draggability||this.DS.continue)return;const i={event:t,isDragging:!0,isDraggingKeyboard:!0,key:e};this.PS.publish(["Interaction:start:pre","Interaction:start"],i),this._elements=this.DS.getSelection(),this._selectionRect=this.DS.Selection.boundingRect,this.handleZIndex(!0);let r=(({shiftKey:t,keyboardDragSpeed:e,zoom:s,key:i,dragKeys:r,scrollDiff:n})=>{const o={x:0,y:0},l=t?4*e*s:e*s;return r?.left.includes(i)&&(o.x=n.x||-l),r?.right.includes(i)&&(o.x=n.x||l),r?.up.includes(i)&&(o.y=n.y||-l),r?.down.includes(i)&&(o.y=n.y||l),o})({shiftKey:this.DS.stores.KeyStore.currentValues.includes("shift"),keyboardDragSpeed:this.Settings.keyboardDragSpeed,zoom:this.Settings.zoom,key:s,scrollDiff:this._scrollDiff,dragKeys:this._dragKeys});r=S({direction:r,containerRect:this.DS.SelectorArea.rect,scrollAmount:this.DS.stores.ScrollStore.scrollAmount,selectionRect:this._selectionRect}),this.moveElements(r),this.PS.publish(["Interaction:update:pre","Interaction:update"],i)};keyboardEnd=({event:t,key:e})=>{const s=e.toLowerCase();if(!(this.Settings.keyboardDrag&&this._dragKeysFlat.includes(s)&&this.DS.SelectedSet.size&&this.Settings.draggability))return;const i={event:t,isDragging:this.Settings.draggability,isDraggingKeyboard:!0,key:e};this.PS.publish(["Interaction:end:pre","Interaction:end"],i)};start=({isDragging:t,isDraggingKeyboard:e})=>{if(t&&!e&&(this._prevCursorPos=void 0,this._prevScrollPos=void 0,this._elements=this.DS.getSelection(),this._selectionRect=this.DS.Selection.boundingRect,this.handleZIndex(!0),this.startDrag=!0,!this._draggingElement)){this._draggingElement=document.createElement("div"),this._draggingElement.classList.add("drag-ghost");const t=this._elements.length>1;this._styles=t?this.DS.Style.stylesItem.manyElem:this.DS.Style.stylesItem.singleElem;const e=this.DS.Style.text,s=this.DS.Style.stylesItem.divManyElWithText;t?(this._divElementOne=null,this._divElementTwo=document.createElement("div"),Object.assign(this._divElementTwo.style,s),this._divElementTwo.textContent=e||null):(this._divElementTwo=null,this._divElementOne=this.DS.Style.picture||null)}};stop=()=>{this._prevCursorPos=void 0,this._prevScrollPos=void 0,this.handleZIndex(!1),this._elements.forEach((t=>{t.classList.remove("isDragging")})),this._elements=[],this._draggingElement?.remove(),this._draggingElement=null};update=({isDragging:t,isDraggingKeyboard:e})=>{if(!t||!this._elements.length||e||this.DS.continue)return;!document.querySelector(".drag-ghost")&&this._draggingElement&&(this.startDrag&&(this.startDrag=!1,this._elements.forEach((t=>{t.classList.add("isDragging")})),Object.assign(this._draggingElement.style,this._styles,{left:this.DS.getCurrentCursorPosition().x-14+"px",top:this.DS.getCurrentCursorPosition().y-15+"px"})),document.body.appendChild(this._draggingElement),this._divElementOne&&this._draggingElement.appendChild(this._divElementOne),this._divElementTwo&&this._draggingElement.appendChild(this._divElementTwo));let s=o(this._cursorDiff,"+",this._scrollDiff);this.addReadyDropZone(),s=S({direction:s,containerRect:this.DS.SelectorArea.rect,scrollAmount:this.DS.stores.ScrollStore.scrollAmount,selectionRect:this._selectionRect}),this.moveElements(s)};handleZIndex=t=>{this.Settings.useLayers&&this._elements.forEach((e=>e.style.zIndex=`${(parseInt(e.style.zIndex)||0)+(t?9999:-9998)}`))};moveElements=t=>{const{elements:e,direction:s}=this.filterDragElements({elements:this._elements,direction:t});(({element:t,posDirection:e,useTransform:s})=>{const i=d(t,s);((t,e,s)=>{if(s){const s=t.style.transform;t.style.transform=`translate3d(${e.x}px,${e.y}px,1px) ${s.replace(/translate.*?\)/g,"")}`}else t.style.left=`${e.x}px`,t.style.top=`${e.y}px`})(t,o(i,"+",e),s)})({element:this._draggingElement?this._draggingElement:e[0],posDirection:s,containerRect:this.DS.SelectorArea.rect,useTransform:this.Settings.useTransform})};get _cursorDiff(){const t=this.DS.stores.PointerStore.currentVal,e=this._prevCursorPos?o(t,"-",this._prevCursorPos):{x:0,y:0};return this._prevCursorPos=t,e}get _scrollDiff(){const t=this.DS.stores.ScrollStore.currentVal,e=this._prevScrollPos?o(t,"-",this._prevScrollPos):{x:0,y:0};return this._prevScrollPos=t,e}addReadyDropZone(){const{x:t,y:e}=this.DS.getCurrentCursorPosition(),s=document.elementsFromPoint(t,e).filter((t=>t.closest(".ds-dropzone-ready"))).find((t=>t.classList.contains("ds-dropzone-ready")));this._readyDropZone&&this._readyDropZone!==s&&this._readyDropZone.classList.remove("ds-dropzone-ready-drop"),this._readyDropZone=s,this._readyDropZone&&this._readyDropZone.classList.add("ds-dropzone-ready-drop")}filterDragElements=({elements:t,direction:e})=>({elements:t,direction:e})}const g=(t,e,s=0)=>{if(!t||!e)return!1;let i=t;if(s>0){const e=(t.right-t.left)*s,r=(t.bottom-t.top)*s;i={left:t.left+e,right:t.right-e,top:t.top+r,bottom:t.bottom-r}}return i.left<e.right&&i.right>e.left&&i.top<e.bottom&&i.bottom>e.top},p=t=>t?Array.isArray(t)||"function"==typeof t[Symbol.iterator]?[...new Set([...t])]:[t]:[];class m{id;element;_droppables;_rect;_observers;_timeout;_itemsDropped=[];_itemsInside;DS;PS;Settings;isDestroyed=!1;_parentNodes;constructor({DS:s,PS:i,id:r,element:n,droppables:o}){this.DS=s,this.PS=i,this.Settings=this.DS.stores.SettingsStore.s,this.id=r,this.element=n,o&&(this.droppables=p(o)),this.element.classList.add(`${this.Settings.dropZoneClass}`),this.PS.subscribe("Settings:updated:dropZoneClass",this.setDropZoneClass),this._observers=t(this.parentNodes,e((()=>this._rect=void 0),this.Settings.refreshMemoryRate)),this.PS.subscribe("Interaction:start",this.start),this.PS.subscribe("Interaction:end",this.stop)}setDropZoneClass=({settings:t})=>{this.element&&(this.element.classList.remove(t["dropZoneClass:pre"]),this.element.classList.add(t.dropZoneClass))};setReadyClasses=t=>{if(this.isDestroyed)return;const e=this.droppables.filter((t=>this.DS.SelectedSet.has(t)));e.length&&(e.forEach((e=>{e.classList[t](`${this.Settings.droppableClass}`),e.classList[t](`${this.Settings.droppableClass}-${this.id}`)})),this.element.closest(".selection")||this.element.classList[t](`${this.Settings.dropZoneReadyClass}`))};handleNoDrop=()=>{this.isDestroyed||(this.DS.SelectedSet.forEach((t=>{t.classList.remove(this.Settings.droppedTargetClass),t.classList.remove(`${this.Settings.droppedTargetClass}-${this.id}`)})),this._itemsDropped=this._itemsDropped.filter((t=>!this.DS.SelectedSet.has(t))),this._itemsDropped?.length||this.element.classList.remove(`${this.Settings.dropZoneTargetClass}`))};handleDrop=()=>{this.isDestroyed||(this._itemsDropped=[...new Set([...this._itemsDropped,...this.droppables?.filter((t=>this.DS.SelectedSet.has(t)))])],this._itemsDropped?.forEach((t=>{t.classList.add(`${this.Settings.droppedTargetClass}`),t.classList.add(`${this.Settings.droppedTargetClass}-${this.id}`)})),this._itemsDropped?.length&&this.element.classList.add(`${this.Settings.dropZoneTargetClass}`))};handleItemsInsideClasses=()=>{let t=!1;this.droppables.forEach((e=>{this.itemsInside?.includes(e)?(e.classList.add(`${this.Settings.droppedInsideClass}`),e.classList.add(`${this.Settings.droppedInsideClass}-${this.id}`),t=!0):(e.classList.remove(`${this.Settings.droppedInsideClass}-${this.id}`),e.className.includes(`${this.Settings.droppedInsideClass}-`)||e.classList.remove(`${this.Settings.droppedInsideClass}`))})),t?this.element.classList.add(`${this.Settings.dropZoneInsideClass}`):this.element.classList.remove(`${this.Settings.dropZoneInsideClass}`)};start=({isDragging:t})=>{t&&!this.isDestroyed&&this.setReadyClasses("add")};stop=({isDragging:t})=>{t&&!this.isDestroyed&&this.setReadyClasses("remove")};destroy(){this._observers?.cleanup(),this._observers=void 0,this.element.classList.remove(`${this.Settings.dropZoneClass}`),this.element.classList.remove(`${this.Settings.dropZoneTargetClass}`),this.element.classList.remove(`${this.Settings.dropZoneReadyClass}`),this.droppables.forEach((t=>{t.classList.remove(`${this.Settings.droppedTargetClass}`),t.classList.remove(`${this.Settings.droppedTargetClass}-${this.id}`),t.classList.remove(`${this.Settings.droppableClass}`),t.classList.remove(`${this.Settings.droppableClass}-${this.id}`)})),this.PS.unsubscribe("Interaction:start",this.start),this.PS.unsubscribe("Interaction:end",this.stop),this.PS.unsubscribe("Settings:updated:dropZoneClass",this.setDropZoneClass),this._itemsDropped=[],this._itemsInside=void 0,this._parentNodes=void 0,this._droppables=void 0,this._rect=void 0,this.isDestroyed=!0}toObject=()=>({id:this.id,element:this.element,droppables:this.droppables,itemsDropped:this.itemsDropped,itemsInside:this.itemsInside});get rect(){if(!this.isDestroyed)return this._rect?this._rect:this._rect=this.element.getBoundingClientRect()}get itemsDropped(){if(!this.isDestroyed)return this._itemsDropped}get itemsInside(){if(!this.isDestroyed)return this._itemsInside||(this._itemsInside=this.droppables.flatMap((t=>{const e=this.DS.SelectableSet.rects.get(t);return this.rect&&g(e,this.rect,this.Settings.dropInsideThreshold)?[t]:[]})),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((()=>this._itemsInside=void 0),this.Settings.refreshMemoryRate)),this._itemsInside}get parentNodes(){return this._parentNodes?this._parentNodes:this._parentNodes=s(this.element)}get droppables(){return this._droppables?this._droppables:this.DS.SelectableSet.elements}set droppables(t){this._droppables=t}}class b{_zoneByElement=new Map;_zoneById=new Map;_zonesByDroppable=new Map;_zones;DS;PS;Settings;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Settings:updated:dropZones",(({settings:t})=>this.setDropZones(t))),this.setDropZones({dropZones:this.Settings.dropZones}),this.PS.subscribe("Interaction:end",this.stop)}setDropZones=({dropZones:t})=>{t&&(this._zones&&(this._zones.forEach((t=>{t.destroy()})),this._zoneByElement.clear(),this._zoneById.clear()),this._zones=t.map((t=>new m({DS:this.DS,PS:this.PS,...t}))),this._zones.forEach((t=>{this._zoneByElement.set(t.element,t),this._zoneById.set(t.id,t)})))};_handleDrops=t=>{this._zones?.forEach((e=>{e!==t&&e.handleNoDrop()})),t&&t.handleDrop()};_getZoneByElementsFromPoint=(t,{x:e,y:s})=>{for(let i=0,r=t.length;i<r;i++){const r=this._zoneByElement.get(t[i]);if(g(r?.rect,{left:e,right:e,top:s,bottom:s},Math.min(this.Settings.dropTargetThreshold,.5)))return r}};stop=({isDragging:t,isDraggingKeyboard:e,event:s})=>{if(!t)return;const i=this.getTarget({isDraggingKeyboard:e,event:s});this._handleDrops(i)};getItemsDroppedById=t=>{const e=this._zoneById.get(t);return e?e.itemsDropped:console.warn(`[DragSelect] No zone found (id: ${t})`)};getItemsInsideById=(t,e)=>{const s=this._zoneById.get(t);return s?s.itemsInside:console.warn(`[DragSelect] No zone found (id: ${t})`)};getKeyboardItemCenter=(t,e)=>{if(!t||!e)return;const s=e.target?.getBoundingClientRect();return{x:s.left+s.width/2,y:s.top+s.height/2}};getTarget=({coordinates:t,isDraggingKeyboard:e,event:s})=>{if(!this._zones?.length)return;let i;!t&&e&&s&&(i=this.getKeyboardItemCenter(e,s));const r=t?.x||i?.x||this.DS.stores.PointerStore.currentVal.x,n=t?.y||i?.y||this.DS.stores.PointerStore.currentVal.y,o=document.elementsFromPoint(r,n);return this._getZoneByElementsFromPoint(o,{x:r,y:n})}}class y{isInteracting;isDragging=!1;DS;PS;Settings;startX=0;startY=0;dragThreshold=5;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Settings:updated:area",(({settings:t})=>{this.removeAreaEventListeners(t["area:pre"]),this.setAreaEventListeners(t.area),this.removeBodyScrollListener(),this.setBodyScrollListener()})),this.PS.subscribe("PointerStore:updated",(({event:t})=>this.update({event:t}))),this.PS.subscribe("Selectable:click",this.onClick),this.PS.subscribe("Selectable:pointer",(({event:t})=>this.start(t))),this.PS.subscribe("Interaction:start:pre",(({event:t})=>this._start(t))),this.PS.subscribe("Interaction:init:pre",this._init),this.PS.subscribe("Interaction:end:pre",(({event:t})=>this._reset(t))),this.PS.subscribe("Area:scroll",this.update)}init=()=>this.PS.publish("Interaction:init:pre",{init:!0});_init=()=>{this.stop(),this.isInteracting=!1,this.DS.Selector.HTMLNode.style.display="none",this.setAreaEventListeners(),this.setBodyScrollListener(),this.PS.publish("Interaction:init",{init:!0})};_canInteract(t){const e="clientX"in t&&0===t.clientX&&0===t.clientY&&0===t.detail&&t.target;return!("button"in t&&2===t.button||this.isInteracting||t.target&&!this.DS.SelectorArea.isInside(t.target)||!e&&!this.DS.SelectorArea.isClicked(t))}start=t=>this.PS.publish("Interaction:start:pre",{event:t,isDragging:this.isDragging});_start=t=>{t.target.closest(".ds-theader")||("touchstart"===t.type&&t.preventDefault(),this._canInteract(t)&&(this.isInteracting=!0,this.isDragging=this.isDragEvent(t),"clientX"in t&&"clientY"in t&&(this.startX=t.clientX,this.startY=t.clientY),this.PS.publish("Interaction:start",{event:t,isDragging:this.isDragging}),this.setDocEventListeners()))};startScroll=t=>{this.PS.publish("Interaction:scroll:pre",{event:t,isDragging:this.isDragging})};isDragEvent=t=>{let e=null;return t.target&&"closest"in t.target&&(e=t.target.closest(`.${this.Settings.selectableClass}`)),!(!this.Settings.draggability||this.DS.stores.KeyStore.isMultiSelectKeyPressed(t)||!e)&&(this.Settings.immediateDrag&&(this.DS.SelectedSet.size?this.DS.SelectedSet.has(e)||(this.DS.SelectedSet.clear(),this.DS.SelectedSet.add(e)):this.DS.SelectedSet.add(e)),!!this.DS.SelectedSet.has(e))};onClick=({event:t})=>{if(!this._canInteract(t))return;if(t.detail>0)return;const{stores:{PointerStore:e,KeyStore:s},SelectableSet:i,SelectedSet:r}=this.DS;e.start(t);const n=t.target;n&&!i.has(n)||(s.isMultiSelectKeyPressed(t)||r.clear(),n&&r.toggle(n),this.reset(t))};stop=(t=this.DS.Area.HTMLNode)=>{this.removeAreaEventListeners(t),this.removeBodyScrollListener(),this.removeDocEventListeners()};update=({event:t,scroll_directions:e,scroll_multiplier:s})=>{if(!this.isInteracting||!t||!("clientX"in t))return;const i=Math.abs(t.clientX-this.startX),r=Math.abs(t.clientY-this.startY);(i>this.dragThreshold||r>this.dragThreshold)&&this.PS.publish(["Interaction:update:pre","Interaction:update"],{event:t,scroll_directions:e,scroll_multiplier:s,isDragging:this.isDragging})};reset=t=>this.PS.publish("Interaction:end:pre",{event:t,isDragging:this.isDragging});_reset=t=>{const{isDragging:e}=this;this.isInteracting=!1,this.isDragging=!1,this.removeDocEventListeners(),this.PS.publish("Interaction:end",{event:t,isDragging:e})};setAreaEventListeners=(t=this.DS.Area.HTMLNode)=>{const e=t.parentElement;e&&(e.addEventListener("mousedown",this.start),e.addEventListener("touchstart",this.start,{passive:!1}))};removeAreaEventListeners=(t=this.DS.Area.HTMLNode)=>{const e=t.parentElement;e&&(this.Settings.usePointerEvents?e.removeEventListener("pointerdown",this.start,{passive:!1}):e.removeEventListener("mousedown",this.start),e.removeEventListener("touchstart",this.start,{passive:!1}))};setDocEventListeners=()=>{this.Settings.usePointerEvents||document.addEventListener("mouseup",this.reset),document.addEventListener("touchend",this.reset)};removeDocEventListeners=()=>{this.Settings.usePointerEvents||document.removeEventListener("mouseup",this.reset),document.removeEventListener("touchend",this.reset)};setBodyScrollListener=()=>{document.body?.addEventListener("scroll",this.startScroll)};removeBodyScrollListener=()=>{document.body?.removeEventListener("scroll",this.startScroll)}}class D{_currentValues=new Set;_keyMapping={control:"ctrlKey",shift:"shiftKey",meta:"metaKey"};DS;PS;settings;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Interaction:init",this.init)}init=()=>{window.addEventListener("blur",this.reset)};keydown=t=>{if(!t.key?.toLocaleLowerCase)return;const e=t.key.toLowerCase();this.PS.publish("KeyStore:down:pre",{event:t,key:e}),this._currentValues.add(e),this.PS.publish("KeyStore:down",{event:t,key:e})};keyup=t=>{};stop=()=>{document.removeEventListener("keydown",this.keydown),document.removeEventListener("keyup",this.reset),window.removeEventListener("blur",this.reset),this.reset()};reset=()=>this._currentValues.clear();isMultiSelectKeyPressed(t){if(this.settings.multiSelectMode)return!0;const e=this.settings.multiSelectKeys?.map((t=>t.toLocaleLowerCase()))??[];return!!this.currentValues.some((t=>e.includes(t)))||!(!t||!e.some((e=>t[this._keyMapping[e]])))}get currentValues(){return Array.from(this._currentValues.values())}}class _{_isMouseInteraction=!1;_initialValArea={x:0,y:0};_currentValArea={x:0,y:0};_lastValArea={x:0,y:0};_initialVal={x:0,y:0};_currentVal={x:0,y:0};_lastVal={x:0,y:0};_lastTouch;DS;PS;settings;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Interaction:init",this.init),this.PS.subscribe("Interaction:start",(({event:t})=>this.start(t))),this.PS.subscribe("Interaction:end",(({event:t})=>this.reset(t)))}init=()=>{document.addEventListener("mousemove",this.update),document.addEventListener("touchmove",this.update,{passive:!1})};start(t){t&&(this._isMouseInteraction=!0,this.currentVal=this.initialVal=this.getPointerPosition(t))}getPointerPosition=t=>(({event:t})=>({x:t.clientX,y:t.clientY}))({event:this._normalizedEvent(t)});update=t=>{t&&(this.PS.publish("PointerStore:updated:pre",{event:t}),this.currentVal=this.getPointerPosition(t),this._isMouseInteraction&&this.PS.publish("PointerStore:updated",{event:t}))};stop=()=>{this.settings.usePointerEvents?document.removeEventListener("pointermove",this.update,{passive:!1}):document.removeEventListener("mousemove",this.update),document.removeEventListener("touchmove",this.update,{passive:!1}),this.reset()};reset=t=>{this.currentVal=this.lastVal=this.getPointerPosition(t),this._isMouseInteraction=!1};_normalizedEvent(t){return!t||t instanceof KeyboardEvent?{clientX:0,clientY:0}:"touches"in t?("touchend"!==t.type&&(this._lastTouch=t),this._lastTouch?.touches[0]||t.touches[0]):t}get initialValArea(){return this._initialValArea?this._initialValArea:{x:0,y:0}}get currentValArea(){return this._currentValArea?this._currentValArea:{x:0,y:0}}get lastValArea(){return this._lastValArea?this._lastValArea:{x:0,y:0}}get initialVal(){return this._initialVal?this._initialVal:{x:0,y:0}}get currentVal(){return this._currentVal?this._currentVal:{x:0,y:0}}get lastVal(){return this._lastVal?this._lastVal:{x:0,y:0}}set initialVal(t){this._initialVal=t,this._initialValArea=t&&o(t,"-",o(l(this.DS.Area.rect),"+",l(this.DS.Area.computedBorder)))}set currentVal(t){this._currentVal=t,this._currentValArea=t&&o(t,"-",o(l(this.DS.Area.rect),"+",l(this.DS.Area.computedBorder)))}set lastVal(t){this._lastVal=t,this._lastValArea=t&&o(t,"-",o(l(this.DS.Area.rect),"+",l(this.DS.Area.computedBorder)))}}class v{subscribers={};DS;constructor({DS:t}){this.DS=t}subscribe=(t,e)=>{Array.isArray(this.subscribers[t])||(this.subscribers[t]=[]);const s=this.subscribers[t];return s.push(e),s.length-1};unsubscribe=(t,e,s)=>{const i=s??this.subscribers[t]?.findIndex((t=>t===e));this.subscribers[t]?.splice(Number(i),1)};publish=(t,e)=>{Array.isArray(t)?t.forEach((t=>this._publish(t,e))):this._publish(t,e)};_publish=(t,e)=>{const s=this.subscribers[t]??[];t.includes(":pre")?this._handlePrePublish(s,e):this._handlePublish(s,e)};_handlePublish=(t,e)=>{for(let s=0,i=t.length;s<i;s++){if(this.DS.stopped)return;t[s]?.(e)}};_handlePrePublish=(t,e)=>{let s=t.length;for(;s--;){if(this.DS.stopped)return;t[s]?.(e)}}}const f=()=>({y:document.body?.scrollTop||document.documentElement?.scrollTop||0,x:document.body?.scrollLeft||document.documentElement?.scrollLeft||0}),P=t=>!t||t instanceof Document?f():{x:t.scrollLeft>=0?t.scrollLeft:f().x,y:t.scrollTop>=0?t.scrollTop:f().y},L=t=>{const e=t.scrollTop,s=Boolean(t.scrollTop=1);return t.scrollTop=e,s},I=()=>({x:f().x,y:f().y});class E{_initialVal={x:0,y:0};_initialValWin={x:0,y:0};_currentVal={x:0,y:0};_currentValWin={x:0,y:0};_canScroll;DS;PS;Settings;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Area:modified",(()=>{this.stop(),this.init()})),this.PS.subscribe("Interaction:init",this.init),this.PS.subscribe("Interaction:start",(()=>this.start())),this.PS.subscribe("Interaction:end",(()=>this.reset()))}init=()=>this.addListeners();addListeners=()=>document.body?.addEventListener("scroll",this.update);removeListeners=()=>document.body?.removeEventListener("scroll",this.update);start=()=>{this._currentVal=this._initialVal=P(this.DS.Area.HTMLNode),this._currentValWin=this._initialValWin=I()};update=()=>{this._currentVal=P(this.DS.Area.HTMLNode),this._currentValWin=I()};stop=()=>{this.reset(),this.removeListeners()};reset=()=>{this._initialVal={x:0,y:0},this._initialValWin={x:0,y:0},this._canScroll=void 0};get canScroll(){return"boolean"==typeof this._canScroll?this._canScroll:this._canScroll=(t=>{const e=P(t);return!(!e.x&&!e.y)||(t instanceof Document?t.body?L(t.body):L(t.documentElement):L(t))})(this.DS.Area.HTMLNode)}get scrollAmount(){const t=o(this.currentVal,"-",this.initialVal),e=h(this.Settings.zoom),s=o(o(t,"*",e),"-",t);return{x:t.x+s.x,y:t.y+s.y}}get scrollAmountWin(){const t=o(this.currentValWin,"-",this.initialValWin);return{x:t.x,y:t.y}}get initialVal(){return this._initialVal?this._initialVal:{x:0,y:0}}get initialValWin(){return this._initialValWin?this._initialValWin:{x:0,y:0}}get currentVal(){return this._currentVal||(this._currentVal=P(this.DS.Area.HTMLNode)),this._currentVal}get currentValWin(){return this._currentValWin||(this._currentValWin=I()),this._currentValWin}}class T extends Set{_rects;_timeout;DS;PS;Settings;_rectRow;constructor({DS:t,PS:e}){super(),this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Interaction:init",this.init),this.PS.subscribe("Settings:updated:selectables",(()=>{this.clear(),this.init()})),this.PS.subscribe("Settings:updated:selectableClass",(({settings:t})=>{this.forEach((e=>{e.classList.remove(t["selectableClass:pre"]),e.classList.add(t.selectableClass)}))}))}init=()=>p(this.Settings.selectables).forEach((t=>this.add(t)));add(t){if(!t||super.has(t))return this;const e={items:this.elements,item:t};return this.PS.publish("Selectable:added:pre",e),t.classList.add(this.Settings.selectableClass),t.addEventListener("click",this._onClick),t.addEventListener("mousedown",this._onPointer),t.addEventListener("touchstart",this._onPointer,{passive:!1}),this.Settings.draggability&&!this.Settings.useTransform&&i({computedStyle:window.getComputedStyle(t),node:t}),this.PS.publish("Selectable:added",e),super.add(t)}delete(t){if(!t||!super.has(t))return!0;const e={items:this.elements,item:t};return this.PS.publish("Selectable:removed:pre",e),t.classList.remove(this.Settings.selectableClass),t.classList.remove(this.Settings.hoverClass),t.removeEventListener("click",this._onClick),this.Settings.usePointerEvents?t.removeEventListener("pointerdown",this._onPointer,{passive:!1}):t.removeEventListener("mousedown",this._onPointer),t.removeEventListener("touchstart",this._onPointer,{passive:!1}),this.PS.publish("Selectable:removed",e),super.delete(t)}clear=()=>this.forEach((t=>this.delete(t)));_onClick=t=>this.PS.publish(["Selectable:click:pre","Selectable:click"],{event:t});_onPointer=t=>this.PS.publish(["Selectable:pointer:pre","Selectable:pointer"],{event:t});addAll=t=>t.forEach((t=>this.add(t)));deleteAll=t=>t.forEach((t=>this.delete(t)));getElementRect=t=>this._rects?this._rects.get(t):t.getBoundingClientRect();get elements(){return Array.from(this.values())}get rowElements(){return Array.from(document.querySelectorAll(".ds"))}get rectRow(){return this._rectRow||(this._rectRow=new Map,this.rowElements.forEach((t=>{this._rectRow?.set(t,t.getBoundingClientRect())})),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((()=>this._rectRow=void 0),this.Settings.refreshMemoryRate)),this._rectRow}get rects(){return this._rects||(this._rects=new Map,this.forEach((t=>this._rects?.set(t,t.getBoundingClientRect()))),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((()=>this._rects=void 0),this.Settings.refreshMemoryRate)),this._rects}}class w extends Set{_rects;_timeout;DS;PS;Settings;selectedElements;constructor({DS:t,PS:e}){super(),this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.selectedElements=[]}add(t){if(!t||super.has(t))return this;const e={items:this.elements,item:t};return this.PS.publish("Selected:added:pre",e),super.add(t),t.classList.add(this.Settings.selectedClass),t.closest(".ds-folder")?this.selectedElements=Array.from(document.querySelectorAll(".ds-selected.dsFolderSelection")):this.selectedElements=Array.from(document.querySelectorAll(".ds-selected:not(.dsFolderSelection)")),this.selectedElements.forEach((t=>{t.classList.remove("selectedFirst","selectedIntermediate","selectedLast")})),this.updateSelectedClasses(this.selectedElements,t),this.Settings.useLayers&&(t.style.zIndex=`${(parseInt(t.style.zIndex)||0)+1}`),this.PS.publish("Selected:added",e),this}delete(t){if(!t||!super.has(t))return!0;const e={items:this.elements,item:t};this.PS.publish("Selected:removed:pre",e);const s=super.delete(t);t.classList.remove(this.Settings.selectedClass);const i=t.parentElement;return i&&i.classList.remove("selection"),t.closest(".ds-folder")?this.selectedElements=Array.from(document.querySelectorAll(".ds-selected.dsFolderSelection")):this.selectedElements=Array.from(document.querySelectorAll(".ds-selected:not(.dsFolderSelection)")),t.classList.remove("selectedFirst","selectedIntermediate","selectedLast"),this.updateSelectedClasses(this.selectedElements,t,!0),this.Settings.useLayers&&(t.style.zIndex=""+((parseInt(t.style.zIndex)||0)-1)),this.PS.publish("Selected:removed",e),s}updateSelectedClasses(t,e,s){const i=e.parentElement?.closest("tr");let r=e,n=t;if(i){const o=Array.from(i.querySelectorAll("td"));o.indexOf(e)>1&&o[1]&&(r=o[1],n=t.map((t=>t.parentElement?.closest("tr")?t.parentElement.querySelectorAll("td")[1]:t)),s?r.classList.remove("selectedFirst","selectedLast","selectedIntermediate"):n.length>1&&n.forEach((t=>{t.classList.remove("selectedFirst","selectedLast","selectedIntermediate")})))}if(1!==n.length||s){if(n&&n.length>0){n[0]&&n[0].classList.add("selectedFirst");const t=n[n.length-1];t&&(t.classList.add("selectedLast"),n.length>1&&n[n.length-2].classList.remove("selectedIntermediate"))}for(let t=1;t<n.length-1;t++)n[t]&&n[t].classList.add("selectedIntermediate")}else r&&r.classList.add("selectedFirst","selectedLast")}clear=()=>this.forEach((t=>this.delete(t)));toggle(t){return this.has(t)?this.delete(t):this.add(t),t}addAll=t=>t.forEach((t=>this.add(t)));deleteAll=t=>t.forEach((t=>this.delete(t)));get elements(){return Array.from(this.values())}get rects(){return this._rects||(this._rects=new Map,this.forEach((t=>this._rects?.set(t,t.getBoundingClientRect()))),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((()=>this._rects=void 0),this.Settings.refreshMemoryRate)),this._rects}}const A=({scrollAmount:t,initialPointerPos:e,pointerPos:s,containerSize:i})=>{if(!i)return;const r={},n={x:e.x-i.left-t.x,y:e.y-i.top-t.y},o={x:s.x-i.left,y:s.y-i.top},l={x:Math.min(Math.max(o.x,0),i.width),y:Math.min(Math.max(o.y,0),i.height)};return l.x>=n.x?(r.left=Math.max(n.x,0),r.width=l.x-n.x,o.x>i.width&&(r.width=i.width-n.x)):(r.left=Math.max(l.x,0),r.width=n.x-l.x,o.x<0&&(r.left=0,r.width=n.x)),l.y>=n.y?(r.top=Math.max(n.y,0),r.height=l.y-n.y,o.y>i.height&&(r.height=i.height-n.y)):(r.top=Math.max(l.y,0),r.height=n.y-l.y,o.y<0&&(r.top=0,r.height=n.y)),r};var C=(t,e)=>{void 0!==e.left&&(t.style.left=`${e.left}px`),void 0!==e.top&&(t.style.top=`${e.top}px`),void 0!==e.width&&(t.style.width=`${e.width}px`),void 0!==e.height&&(t.style.height=`${e.height}px`)};class x{_rect;DS;PS;Settings;ContainerSize;isSelecting=!1;autoScroll=!1;scrollSelector=!1;HTMLNode;scrollIntervalId=null;scrollSpeed=0;minScrollSpeed=10;maxScrollSpeed=20;scrollInterval=50;edgeThreshold=5;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.HTMLNode=this.Settings.selector,this.PS.subscribe("Settings:updated:selectorClass",(({settings:t})=>{this.HTMLNode.classList.remove(t["selectorClass:pre"]),this.HTMLNode.classList.add(t.selectorClass)})),this.PS.subscribe("Settings:updated:selector",this.attachSelector),this.PS.subscribe("Settings:updated:customStyles",this.attachSelector),this.attachSelector(),this.PS.subscribe("Interaction:start",this.start),this.PS.subscribe("Interaction:update",this.update),this.PS.subscribe("Interaction:end",this.stop),this.PS.subscribe("Interaction:scroll:pre",(({isDragging:t})=>{setTimeout((()=>this.updateWithScroll({isDragging:t})),0)}))}attachSelector=()=>{this.HTMLNode&&this.DS.SelectorArea?.HTMLNode&&this.DS.SelectorArea.HTMLNode.removeChild(this.HTMLNode),this.HTMLNode=this.Settings.selector||(t=>{const e=document.createElement("div");return e.style.position="absolute",t||(e.style.background="rgba(0, 175, 255, 0.2)",e.style.border="1px solid rgba(0, 175, 255, 0.8)",e.style.display="none",e.style.pointerEvents="none"),e})(this.Settings.customStyles),this.HTMLNode.classList.add(this.Settings.selectorClass),this.HTMLNode&&this.DS.SelectorArea?.HTMLNode&&this.DS.SelectorArea.HTMLNode.appendChild(this.HTMLNode)};start=({isDragging:t})=>{if(t)return;const{stores:{PointerStore:e},Area:{HTMLNode:s}}=this.DS;if("#document"===s.nodeName)return;const i=e.initialValArea;C(this.HTMLNode,a(i,1)),this.DS.SelectorArea.HTMLNodeSize&&(this.ContainerSize={top:this.DS.SelectorArea.HTMLNodeSize.top,left:this.DS.SelectorArea.HTMLNodeSize.left,width:this.DS.SelectorArea.HTMLNodeSize.width,height:this.DS.SelectorArea.HTMLNodeSize.height}),this._rect=void 0};stop=()=>{this.HTMLNode.style.width="0",this.HTMLNode.style.height="0",this.HTMLNode.style.display="none",this.scrollSelector=!1,this.stopAutoScroll(),this.isSelecting&&(this.isSelecting=!1,setTimeout((()=>{document.removeEventListener("click",this.captureClick,!0)}),0))};update=({isDragging:t})=>{if(t||this.DS.continue)return;const{stores:{ScrollStore:e,PointerStore:s}}=this.DS,{x:i,y:r}=this.DS.getCurrentCursorPosition(),{x:n,y:o}=this.DS.getInitialCursorPosition();if(Math.abs(i-n)<=5&&Math.abs(r-o)<=5)return;this.scrollSelector=!0,this.DS.SelectorArea.updatePos(),this.scroll(),this.isSelecting||(this.isSelecting=!0,document.addEventListener("click",this.captureClick,!0)),"block"!==this.HTMLNode.style.display&&(this.HTMLNode.style.display="block");const l={x:n,y:o},a={x:i+window.scrollX,y:r+window.scrollY},h=A({scrollAmount:e.scrollAmountWin,initialPointerPos:l,pointerPos:a,containerSize:this.ContainerSize});h&&(h.left<0&&(h.left=0),h.top<0&&(h.top=0),h.width<0&&(h.width=0),h.height<0&&(h.height=0),C(this.HTMLNode,h)),this._rect=void 0,this.checkForAutoScroll({x:i,y:r})};updateWithScroll=({isDragging:t})=>{if(t||this.DS.continue)return;const{stores:{ScrollStore:e}}=this.DS,{x:s,y:i}=this.DS.getCurrentCursorPosition(),{x:r,y:n}=this.DS.getInitialCursorPosition();if(!this.scrollSelector)return;this.DS.SelectorArea.updatePos(),this.scroll(),this.isSelecting||(this.isSelecting=!0,document.addEventListener("click",this.captureClick,!0)),"block"!==this.HTMLNode.style.display&&(this.HTMLNode.style.display="block");const o={x:r,y:n},l={x:s+window.scrollX,y:i+window.scrollY},a=A({scrollAmount:e.scrollAmountWin,initialPointerPos:o,pointerPos:l,containerSize:this.ContainerSize});a&&C(this.HTMLNode,a),this.updateSelections(),this._rect=void 0};updateSelections(){setTimeout((()=>{const{x:t,y:e}=this.DS.getCurrentCursorPosition(),s=new MouseEvent("mousemove",{clientX:t,clientY:e,bubbles:!0,cancelable:!0,view:window});s.isSimulated=!0,document.dispatchEvent(s)}),200)}captureClick(t){t.stopPropagation()}scroll(){this.DS?.SelectorArea.HTMLNodeSize&&(this.ContainerSize={top:this.DS.SelectorArea.HTMLNodeSize.top,left:this.DS.SelectorArea.HTMLNodeSize.left,width:this.DS.SelectorArea.HTMLNodeSize.width,height:this.DS.SelectorArea.HTMLNodeSize.height})}get rect(){return this._rect?this._rect:this._rect=this.HTMLNode.getBoundingClientRect()}startAutoScroll=t=>{if(this.autoScroll)return;this.autoScroll=!0;this.scrollIntervalId=setInterval((()=>{"up"===t?document.body.scrollBy(0,-this.scrollSpeed):document.body.scrollBy(0,this.scrollSpeed)}),this.scrollInterval)};stopAutoScroll=()=>{null!==this.scrollIntervalId&&(clearInterval(this.scrollIntervalId),this.scrollIntervalId=null),this.scrollSpeed=0};checkForAutoScroll=t=>{const{innerHeight:e}=window,s=t.y,i=e-t.y;t.y<this.edgeThreshold?(this.scrollSpeed=this.calculateScrollSpeed(s),this.startAutoScroll("up")):t.y>e-this.edgeThreshold?(this.scrollSpeed=this.calculateScrollSpeed(i),this.startAutoScroll("down")):(this.stopAutoScroll(),this.autoScroll=!1)};calculateScrollSpeed=t=>{const e=this.minScrollSpeed+(this.maxScrollSpeed-this.minScrollSpeed)*Math.pow((this.edgeThreshold-t)/this.edgeThreshold,2);return Math.min(e,this.maxScrollSpeed)}}class M{_prevSelectedSet=new Set;_boundingRect;_timeout;DS;PS;Settings;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.PS.subscribe("Interaction:start",this.start),this.PS.subscribe("Interaction:update",this.update),this.PS.subscribe("Interaction:scroll:pre",(({isDragging:t})=>{this.DS.Selector.scrollSelector&&this.update({isDragging:t})}))}_storePrevious(t){this.DS,this._prevSelectedSet=new Set}start=({event:t,isDragging:e})=>{e||(this._storePrevious(t),this._handleInsideSelection(!0,t))};update=({isDragging:t})=>{t||this.DS.continue||this._handleInsideSelection()};_handleInsideSelection=(t,e)=>{const{SelectableSet:s,SelectorArea:i,Selector:r}=this.DS,n=this.DS.stores.KeyStore.isMultiSelectKeyPressed(e)&&this.Settings.multiSelectToggling,o=this.Settings.selectionThreshold;s.rects;const l=s.rectRow,a=r.rect,h=new Map,c=new Map;for(const[t,e]of l){const s=t.querySelector(".ds-selectable");if(!s)return;const r=s.getBoundingClientRect();if(i.isInside(t,e))if(g(e,a,o)){const t=s.parentElement;t&&t.classList.add("selection"),h.set(s,r)}else{const t=s.parentElement;t&&t.classList.remove("selection"),c.set(s,r)}}if(this.DS.continue)return;const{select:d,unselect:S}=this.filterSelected({select:h,unselect:c,selectorRect:a});d.forEach(((e,s)=>(({element:t,force:e,multiSelectionToggle:s,SelectedSet:i,hoverClassName:r})=>{t.classList.contains(r)&&!e||(i.has(t)?s&&i.delete(t):i.add(t),t.classList.add(r))})({element:s,force:t,multiSelectionToggle:n,SelectedSet:this.DS.SelectedSet,hoverClassName:this.Settings.hoverClass}))),S.forEach(((e,s)=>(({element:t,force:e,SelectedSet:s,PrevSelectedSet:i,hoverClassName:r})=>{if(!t.classList.contains(r)&&!e)return;const n=s.has(t),o=i.has(t);n&&!o?s.delete(t):!n&&o&&s.add(t),t.classList.remove(r)})({element:s,force:t,SelectedSet:this.DS.SelectedSet,hoverClassName:this.Settings.hoverClass,PrevSelectedSet:this._prevSelectedSet})))};get boundingRect(){return this._boundingRect||(this._boundingRect=(t=>{const e={top:Number.POSITIVE_INFINITY,left:Number.POSITIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,right:Number.NEGATIVE_INFINITY,width:Number.NEGATIVE_INFINITY,height:Number.NEGATIVE_INFINITY};return t.rects.forEach((t=>{e.top=Math.min(e.top,t.top||e.top),e.left=Math.min(e.left,t.left||e.left),e.bottom=Math.max(e.bottom,t.bottom||e.bottom),e.right=Math.max(e.right,t.right||e.right)})),e.height=e.bottom-e.top,e.width=e.right-e.left,e})(this.DS.SelectedSet),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((()=>this._boundingRect=void 0),this.Settings.refreshMemoryRate)),this._boundingRect}filterSelected=({select:t,unselect:e,selectorRect:s})=>({select:t,unselect:e})}class N{_scrollInterval;_rect;currentEdges=[];DS;PS;Settings;HTMLNode;HTMLNodeSize;constructor({DS:t,PS:e}){this.DS=t,this.PS=e,this.Settings=this.DS.stores.SettingsStore.s,this.HTMLNode=(()=>{const t=document.createElement("div");return t.style.position="fixed",t.style.overflow="visible",t.style.pointerEvents="none",t.style.zIndex="999999999999999999",t})(),this.PS.subscribe("Settings:updated:selectorAreaClass",(({settings:t})=>{this.HTMLNode.classList.remove(t["selectorAreaClass:pre"]),this.HTMLNode.classList.add(t.selectorAreaClass)})),this.HTMLNode.classList.add(this.Settings.selectorAreaClass),this.PS.subscribe("Area:modified",this.updatePos),this.PS.subscribe("Area:modified",this.updatePos),this.PS.subscribe("Interaction:init",this.init),this.PS.subscribe("Interaction:start",(({isDraggingKeyboard:t})=>this.startAutoScroll({isDraggingKeyboard:t}))),this.PS.subscribe("Interaction:end",(()=>{this.updatePos(),this.stopAutoScroll()}))}init=()=>{this.applyElements("append"),this.updatePos()};applyElements=t=>{const e=document.body?"body":"documentElement",s=`${t}Child`;"remove"===t&&this.DS.Selector.HTMLNode?.parentNode&&this.HTMLNode[s](this.DS.Selector.HTMLNode),"remove"===t&&this.HTMLNode?.parentNode&&document[e][s](this.HTMLNode),"append"===t&&(this.HTMLNode[s](this.DS.Selector.HTMLNode),document[e][s](this.HTMLNode))};clampSelectionArea=t=>{const e=this.DS.Area.rect;return{top:Math.max(e.top,t.top),left:Math.max(e.left,t.left),right:Math.min(e.right,t.right),bottom:Math.min(e.bottom,t.bottom),width:Math.min(e.width,t.width),height:Math.min(e.height,t.height)}};updatePos=()=>{this._rect=void 0;const t=this.DS.Area.rect,e=this.DS.Area.computedBorder,{style:s}=this.HTMLNode,i=window.scrollX,r=window.scrollY;this.HTMLNodeSize={top:t.top+e.top+r,left:t.left+e.left+i,width:t.width,height:t.height};const n=`${t.top+e.top}px`,o=`${t.left+e.left}px`,l=`${t.width}px`,a=`${t.height}px`;s.top!==n&&(s.top=n),s.left!==o&&(s.left=o),s.width!==l&&(s.width=l),s.height!==a&&(s.height=a)};stop=t=>{this.stopAutoScroll(),t&&this.applyElements("remove")};startAutoScroll=({isDraggingKeyboard:t})=>{t||(this.currentEdges=[],this._scrollInterval=setInterval((()=>this.handleAutoScroll()),16))};handleAutoScroll=()=>{if(this.DS.continue)return;const{stores:{PointerStore:t},Area:e}=this.DS;this.currentEdges=(({elementRect:t,containerRect:e,tolerance:s={x:0,y:0}})=>{const i=[];return t.top-s.y<e.top&&i.push("top"),t.left-s.x<e.left&&i.push("left"),t.bottom+s.y>e.bottom&&i.push("bottom"),t.right+s.y>e.right&&i.push("right"),i})({elementRect:a(t.currentVal),containerRect:this.rect,tolerance:this.Settings.overflowTolerance}),this.currentEdges.length&&e.scroll(this.currentEdges,this.Settings.autoScrollSpeed)};stopAutoScroll=()=>{this.currentEdges=[],clearInterval(this._scrollInterval)};isInside=(t,e)=>!(!this.DS.Area.HTMLNode.contains(t)||!this.DS.stores.ScrollStore.canScroll)||g(this.rect,e||t.getBoundingClientRect());isClicked(t){const{stores:{PointerStore:e}}=this.DS,s=t?e.getPointerPosition(t):e.initialVal;return g({left:s.x,top:s.y,right:s.x,bottom:s.y},this.rect)}get rect(){return this._rect?this._rect:this._rect=this.HTMLNode.getBoundingClientRect()}}const V=(t,e)=>console.warn(`[DragSelect] TypeIssue: setting "${t}" is not of type "${e}".`),H=(t,e,s,i)=>{if(void 0===e)return s?{[t]:i}:{};if(null===e)return{[t]:null};let r=!0,n=!1;const o="string"==typeof i;o&&(r="string"==typeof e||e instanceof String),o&&!r&&(n=!0,V(t,"string"));const l=!Number.isNaN(i)&&"number"==typeof i;l&&(r=!Number.isNaN(e)&&"number"==typeof e),l&&!r&&(n=!0,V(t,"number"));const a="[object Object]"===Object.prototype.toString.call(i);a&&(r="[object Object]"===Object.prototype.toString.call(e)),a&&!r&&(n=!0,V(t,"object"));const h="boolean"==typeof i;h&&(r="boolean"==typeof e),h&&!r&&(n=!0,V(t,"boolean"));const c=Array.isArray(i);c&&(r=Array.isArray(e)),c&&!r&&(n=!0,V(t,"array"));const d=n||s;return"dragKeys"===t&&r?{[t]:Object.assign(i,e)}:"dragKeys"!==t||r?("dropZones"===t&&r&&Array.isArray(e)&&new Set(e.map((t=>t.id))).size!==e.length&&console.warn('[DragSelect] UniqueConstraintsIssue: setting "dropZones" contains duplicate ids.'),r?{[t]:e}:d?{[t]:i}:{}):d?{[t]:i}:{}};class R{_settings={};s={};PS;constructor({PS:t,settings:e}){this.PS=t,this.update({settings:e,init:!0})}update=({settings:t,init:e})=>{this.PS.publish("Settings:updated:pre",{settings:this._settings,"settings:init":Boolean(e),"settings:new":t}),this._update({settings:t,init:e})};_update=({settings:t={},init:e=!1})=>{const s=((t,e)=>({...H("area",t.area,e,document),...H("selectables",t.selectables,e,null),...H("autoScrollSpeed",t.autoScrollSpeed,e,5),...H("overflowTolerance",t.overflowTolerance,e,{x:25,y:25}),...H("zoom",t.zoom,e,1),...H("customStyles",t.customStyles,e,!1),...H("multiSelectMode",t.multiSelectMode,e,!1),...H("multiSelectToggling",t.multiSelectToggling,e,!0),...H("multiSelectKeys",t.multiSelectKeys,e,["Control","Shift","Meta"]),...H("selector",t.selector,e,null),...H("selectionThreshold",t.selectionThreshold,e,0),...H("draggability",t.draggability,e,!0),...H("immediateDrag",t.immediateDrag,e,!0),...H("keyboardDrag",t.keyboardDrag,e,!0),...H("dragKeys",t.dragKeys,e,{up:["ArrowUp"],down:["ArrowDown"],left:["ArrowLeft"],right:["ArrowRight"]}),...H("keyboardDragSpeed",t.keyboardDragSpeed,e,10),...H("useTransform",t.useTransform,e,!0),...H("refreshMemoryRate",t.refreshMemoryRate,e,80),...H("dropZones",t.dropZones,e,[]),...H("dropInsideThreshold",t.dropInsideThreshold,e,1),...H("dropTargetThreshold",t.dropTargetThreshold,e,0),...H("usePointerEvents",t.usePointerEvents,e,!1),...H("hoverClass",t.hoverClass,e,"ds-hover"),...H("selectableClass",t.selectableClass,e,"ds-selectable"),...H("selectedClass",t.selectedClass,e,"ds-selected"),...H("selectorClass",t.selectorClass,e,"ds-selector"),...H("selectorAreaClass",t.selectorAreaClass,e,"ds-selector-area"),...H("droppedTargetClass",t.droppedTargetClass,e,"ds-dropped-target"),...H("droppedInsideClass",t.droppedInsideClass,e,"ds-dropped-inside"),...H("droppableClass",t.droppableClass,e,"ds-droppable"),...H("dropZoneClass",t.dropZoneClass,e,"ds-dropzone"),...H("dropZoneReadyClass",t.dropZoneReadyClass,e,"ds-dropzone-ready"),...H("dropZoneTargetClass",t.dropZoneTargetClass,e,"ds-dropzone-target"),...H("dropZoneInsideClass",t.dropZoneInsideClass,e,"ds-dropzone-inside"),...H("useLayers",t.useLayers,e,!0)}))(t,e);for(const[i,r]of Object.entries(s))((s,i)=>{s in this._settings||Object.defineProperty(this.s,s,{get:()=>this._settings[s],set:t=>this.update({settings:{[s]:t}})}),this._settings[`${s}:pre`]=this._settings[s],this._settings[s]=i;const r={settings:this._settings,"settings:init":e,"settings:new":t};this.PS.publish("Settings:updated",r),this.PS.publish(`Settings:updated:${s}`,r)})(i,r)}}const z={elementselect:"DS:select",elementunselect:"DS:unselect",autoscroll:"DS:scroll",dragstart:"DS:start",dragmove:"DS:update",callback:"DS:end",preelementselect:"DS:select:pre",preelementunselect:"DS:unselect:pre",preautoscroll:"DS:scroll:pre",predragstart:"DS:start:pre",predragmove:"DS:update:pre",precallback:"DS:end:pre"},k=(t,e)=>{const s=e.DropZones.getTarget(t);return{...t,...s?{dropTarget:s.toObject()}:{}}},K=({sub_name:t,DS:e,PS:s,sub_pubs:i})=>{s.subscribe(t,(t=>i.forEach((s=>B({sub_pub:s,data:t,DS:e})))))},B=({sub_pub:t,data:e,DS:s})=>{const i=t.condition?t.condition(e,s):e;if(i){const r=t.extraData&&t.extraData(e,s)||{};s.publish(t.name,{items:s.SelectedSet.elements,isDragging:s.Interaction.isDragging,...i,...r})}};class Z{continue=!1;PubSub;stores;Area;Selector;SelectorArea;SelectableSet;SelectedSet;Selection;Drag;DropZones;Interaction;stopped;Style;constructor(t){this.stopped=!1,this.PubSub=new v({DS:this}),this.stores={},this.stores.SettingsStore=new R({settings:t,PS:this.PubSub}),this.stores.PointerStore=new _({DS:this,PS:this.PubSub}),this.stores.ScrollStore=new E({DS:this,PS:this.PubSub}),this.stores.KeyStore=new D({DS:this,PS:this.PubSub}),this.Area=new n({DS:this,PS:this.PubSub}),this.Selector=new x({DS:this,PS:this.PubSub}),this.SelectorArea=new N({DS:this,PS:this.PubSub}),this.SelectableSet=new T({DS:this,PS:this.PubSub}),this.SelectedSet=new w({DS:this,PS:this.PubSub}),this.Selection=new M({DS:this,PS:this.PubSub}),this.Drag=new u({DS:this,PS:this.PubSub}),this.DropZones=new b({DS:this,PS:this.PubSub}),this.Interaction=new y({DS:this,PS:this.PubSub}),(({PS:t,DS:e})=>{const s={"Selected:added":[{name:"preelementselect"},{name:"elementselect"},{name:"DS:select:pre"},{name:"DS:select"}],"Selected:removed":[{name:"preelementunselect"},{name:"elementunselect"},{name:"DS:unselect:pre"},{name:"DS:unselect"}],"Selectable:added":[{name:"DS:added:pre"},{name:"DS:added"}],"Selectable:removed":[{name:"DS:removed:pre"},{name:"DS:removed"}],"Area:scroll":[{name:"preautoscroll"},{name:"autoscroll"},{name:"DS:scroll:pre"},{name:"DS:scroll"}],"Interaction:start":[{name:"predragstart"},{name:"dragstart"},{name:"DS:start:pre"},{name:"DS:start"}],"Interaction:update":[{name:"predragmove",condition:t=>t.event?t:null},{name:"dragmove",condition:t=>t.event?t:null},{name:"DS:update:pre",condition:t=>t.event?t:null},{name:"DS:update",condition:t=>t.event?t:null}],"Interaction:end":[{name:"precallback",extraData:(t,e)=>k(t,e)},{name:"callback",extraData:(t,e)=>k(t,e)},{name:"DS:end:pre",extraData:(t,e)=>k(t,e)},{name:"DS:end",extraData:(t,e)=>k(t,e)}]};for(const[i,r]of Object.entries(s))K({sub_name:i,sub_pubs:r,DS:e,PS:t})})({DS:this,PS:this.PubSub}),this.PubSub.subscribe("Interaction:end",(()=>this.continue=!1)),this.PubSub.subscribe("DS:end",(({items:t})=>this.continue=!1)),this.Style={stylesItem:{}},this.start()}static isCollision;subscribe=(t,e)=>{z[t]&&console.warn(`[DragSelect]: The event name "${t}" is deprecated and was/will be removed in a future version. Please use the new event name "${z[t]}" instead.`),this.PubSub.subscribe(t,e)};unsubscribe=(t,e,s)=>this.PubSub.unsubscribe(t,e,s);publish=(t,e)=>this.PubSub.publish(t,e);start=()=>{/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||(this.stopped=!1,this.Interaction.init())};stop(t=!0,e=!0,s=!1){s&&this.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),this.Interaction.stop(),this.Area.stop(),this.Drag.stop(),this.Selector.stop(),this.SelectorArea.stop(t),this.stores.KeyStore.stop(),this.stores.PointerStore.stop(),this.stores.ScrollStore.stop(),t&&this.SelectableSet.clear(),e&&this.SelectedSet.clear(),this.stopped=!0}break=()=>this.continue=!0;setSettings=t=>this.stores.SettingsStore.update({settings:t});getSelection=()=>this.SelectedSet.elements;addSelection(t,e=!1,s=!1){const i=p(t);return this.SelectedSet.addAll(i),s||this.addSelectables(t,!1,!1),e&&this.PubSub.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),this.getSelection()}removeSelection(t,e=!1,s=!1){const i=p(t);return this.SelectedSet.deleteAll(i),s&&this.removeSelectables(t,!1,!1),e&&this.PubSub.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),this.getSelection()}toggleSelection(t,e=!1,s=!1){return p(t).forEach((i=>this.SelectedSet.has(i)?this.removeSelection(t,e,s):this.addSelection(t,e,s))),e&&this.PubSub.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),this.getSelection()}setSelection(t,e=!1,s=!1){return this.clearSelection(),this.addSelection(t,e,s),this.getSelection()}clearSelection(t=!1){return this.SelectedSet.clear(),t&&this.PubSub.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),this.getSelection()}addSelectables(t,e,s){const i=p(t);return this.SelectableSet.addAll(i),e&&this.SelectedSet.addAll(i),s&&this.PubSub.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),i}addStyles(t,e,s){this.Style.stylesItem.singleElem=t.singleElem,this.Style.stylesItem.manyElem=t.manyElem,this.Style.stylesItem.divManyElWithText=t.divManyElWithText,this.Style.picture=e,this.Style.text=s}getSelectables=()=>this.SelectableSet.elements;removeSelectables(t,e,s){const i=p(t);return this.SelectableSet.deleteAll(i),e&&this.removeSelection(t),s&&this.PubSub.publish("DS:end",{items:this.SelectedSet.elements,isDragging:this.Interaction.isDragging}),i}getInitialCursorPosition=()=>this.stores.PointerStore.initialVal;getCurrentCursorPosition=()=>this.stores.PointerStore.currentVal;getPreviousCursorPosition=()=>this.stores.PointerStore.lastVal;getInitialCursorPositionArea=()=>this.stores.PointerStore.initialValArea;getCurrentCursorPositionArea=()=>this.stores.PointerStore.currentValArea;getPreviousCursorPositionArea=()=>this.stores.PointerStore.lastValArea;isMultiSelect=t=>this.stores.KeyStore.isMultiSelectKeyPressed(t);isDragging=()=>this.Interaction.isDragging;getZoneByCoordinates=t=>this.DropZones.getTarget({coordinates:t})?.toObject();getItemsDroppedByZoneId=t=>this.DropZones.getItemsDroppedById(t);getItemsInsideByZoneId=(t,e)=>this.DropZones.getItemsInsideById(t,e)}Z.isCollision=g;export{Z as default};